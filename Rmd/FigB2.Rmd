---
title: "EWGrantCryptoFigure"
author: "Liz Hughes"
date: "13/03/2022"
output:
  html_document:
    toc: yes
    toc_depth: 2
  word_document:
    toc: yes
    toc_depth: '2'
  pdf_document:
    toc: yes
    toc_depth: '2'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Cryptococcus Part B2 Figure

This code will produce a  figure that demonstrates that we can successfully transform and do complementation in Cryptococcus, to argue that we should be able to do similar experiments with Ssd1. The Gat201 complementation is the best evidence that we have for that.
A short 3-panel figure showing:
A. Overview of CryptoMobius for gene complementation
B. Simple evidence that we complemented a Gat201 phenotype - I think if there are some clear growth curve or colony assays from @Liz Hughes? The one on the Jan seminar is nice but a bit complicated, too many replicate lines to be clear for a grant application.
C. (maybe) One clear panel showing that we can express a fluorescent protein using CryptoMobius? Microscopy or flow or colonies on plates are fine.

# Load packages

```{r load_packages}
library("reshape2")
library(dplyr)
library(ggplot2)
library(tidyverse)
library(markdown)
library(cowplot)
```

#Plate reader assay.

Set up to test growth of WT and Gat201 complemented strains in RPMI at 37 degrees.
1 Biorep, 4 Techreps each: 3 WT Strains (H99, KN99-alpha and KN99a), Madhani Gat201 deletion mutant and Gat201-complemented strains 23,26,30,32,36,44,46,50,51 and 53.
Grow 5ml culture from colony (1 colony = 1 Biorep)in YPD, 30C, 200 rpm ON.
Seed at OD 600nm = 0.2; 200 ul per well.
Run for 500 cycles.

Note: 
There was condensation on the lid of wells C8 (Gat201-M1.3), C9 (Gat201-M1.4) and C10 (23 1.3) . D8 (36 1.1) and 9 (36 1.2). E9 (36 1.4).
These wells will be removed from the analysis.
The plate was set up and running and by mistake the door was opened and plate removed after about an hour. I put the plate back in and started the run again.


# Read in transposed data as csv file

```{r csv_file}
rawdata <- read.csv("~/Edward Wallace/R/R files/Data/2021/PR17 transpose_CSV.csv")

```

# Change time in seconds to time in hours

```{r mutate_time}
rawdata_day<-mutate(rawdata, Time = Time/86400)

```

# Tidy the data using the melt function from reshape2

```{r reshape}
reshaped <- melt(rawdata_day, id=c("Time", "Temp"), variable.name="Well",
                 value.name="OD595")

```

# Read in the Plate map data from csv file

```{r Load_platemap}
platemap <- read.csv("~/Edward Wallace/R/R files/Data/2021/20210608_PR17_ComplRPMI.csv ")

```

# Combine the reshaped data with the plate map, pairing them by Well


```{r combine the data file and platemap file}
annotated <- inner_join(reshaped, platemap, by="Well")
 
```

# Re-order the legend to match the lines

```{r}
normalisedOD$Strain <- factor(normalisedOD$Strain, levels = c("Gat201-M", "Clone 2", "Clone 1", "KN99a", "KN99A"))

```


## Calculate median OD for blank wells for each growth medium
Remove wells A1, A12, B1, C1, D1, E1, F1, F10, F11, G1 and H1 from the analysis.
```{r calc_blank_medians}
blank_OD_summary <- annotated %>%
  filter(Strain=="") %>%
  filter(Well!= "A1")%>%
  filter(Well!= "A12")%>%
  filter(Well!= "B1")%>%
  filter(Well!= "C1")%>%
  filter(Well!= "D1")%>%
  filter(Well!= "E1")%>%
  filter(Well!= "F1")%>%
  filter(Well!= "F101")%>%
  filter(Well!= "F111")%>%
  filter(Well!= "G1")%>%
  filter(Well!= "H1")%>%
  group_by(Medium) %>%
  summarise(OD_median=median(OD595),
            OD_mean=mean(OD595),
            OD_max=max(OD595),
            OD_min=min(OD595))

```

# Subtract blank OD to make corrected OD and Plot OD_corrected v Time (hrs)
## Remove excess comlpemented strains 
(I know there must be a better way to do this, I just think of one right now)

```{r}
normalisedOD <- annotated %>%
  left_join(blank_OD_summary, by="Medium") %>%
  filter(Well!= "A1")%>%
  filter(Well!= "A2")%>%
  filter(Well!= "A3")%>%
  filter(Well!= "A4")%>%
  filter(Well!= "A5")%>%
  filter(Well!= "A6")%>%
  filter(Well!= "A7")%>%
  filter(Well!= "A8")%>%
  filter(Well!= "A9")%>%
  filter(Well!= "A10")%>%
  filter(Well!= "A11")%>%
  filter(Well!= "A12")%>%
  filter(Well!= "B1")%>%
  filter(Well!= "B2")%>%
  filter(Well!= "B3")%>%
  filter(Well!= "B10")%>%
  filter(Well!= "B11")%>%
  filter(Well!= "B12")%>%
  filter(Well!= "C1")%>%
  filter(Well!= "C2")%>%
  filter(Well!= "C3")%>%
  filter(Well!= "C10")%>%
  filter(Well!= "C11")%>%
  filter(Well!= "C12")%>%
  filter(Well!= "D1")%>%
  filter(Well!= "D6")%>%
  filter(Well!= "D7")%>%
  filter(Well!= "D8")%>%
  filter(Well!= "D9")%>%
  filter(Well!= "D10")%>%
  filter(Well!= "D11")%>%
  filter(Well!= "D12")%>%
  filter(Well!= "E1")%>%
  filter(Well!= "E6")%>%
  filter(Well!= "E7")%>%
  filter(Well!= "E8")%>%
  filter(Well!= "E9")%>%
  filter(Well!= "E10")%>%
  filter(Well!= "E11")%>%
  filter(Well!= "E12")%>%
  filter(Well!= "F1")%>%
  filter(Well!= "F2")%>%
  filter(Well!= "F3")%>%
  filter(Well!= "F4")%>%
  filter(Well!= "F5")%>%
  filter(Well!= "F6")%>%
  filter(Well!= "F7")%>%
  filter(Well!= "F8")%>%
  filter(Well!= "F9")%>%
  filter(Well!= "F10")%>%
  filter(Well!= "F11")%>%
  filter(Well!= "F12")%>%
  filter(Well!= "G1")%>%
  filter(Well!= "G2")%>%
  filter(Well!= "G3")%>%
  filter(Well!= "G4")%>%
  filter(Well!= "G5")%>%
  filter(Well!= "G6")%>%
  filter(Well!= "G7")%>%
  filter(Well!= "G8")%>%
  filter(Well!= "G9")%>%
  filter(Well!= "G10")%>%
  filter(Well!= "G11")%>%
  filter(Well!= "G12")%>%
  filter(Well!= "H1")%>%
  filter(Well!= "H2")%>%
  filter(Well!= "H3")%>%
  filter(Well!= "H4")%>%
  filter(Well!= "H5")%>%
  filter(Well!= "H6")%>%
  filter(Well!= "H7")%>%
  filter(Well!= "H8")%>%
  filter(Well!= "H9")%>%
  filter(Well!= "H10")%>%
  filter(Well!= "H11")%>%
  filter(Well!= "H12")%>%
  filter(Well!= "C8")%>%
  filter(Well!= "C9")%>%
  filter(Well!= "C10")%>%
  filter(Well!= "D8")%>%
  filter(Well!= "D9")%>%
  filter(Well!= "E9")%>%
  filter(Well!= "D10")%>%
  filter(Well!= "E10")%>%
  mutate(OD_corrected = OD595 - OD_median)
```


## Plot OD all stat_summary(geom -"line") stat_summary

```{r plot_all_stat_summary}

PR17 <- ggplot(data=normalisedOD %>%
                filter(Strain != ""),
                aes(x=Time, y=OD_corrected, colour = Strain)) + 
                stat_summary(fun = "median", geom = "line", size = 1) +
                scale_y_continuous(limits=c(0,0.45),expand=c(0,0)) +
                geom_hline(aes(yintercept=0.15), linetype="dotted", colour="black") +
       labs(x = "Number of Days",
            y = "Absorbance (595nm)",
            title = "Gat201 Complemented Strains") +
       theme_bw() +
       theme(text = element_text(size = 15))+
       theme(axis.title = element_text(size = 23))+
       theme(axis.ticks.length = unit(0.3, "cm"))+
       theme(title = element_text(size = 25))+
       theme(panel.grid.minor = element_blank())+
       theme(legend.title = element_text(size = 20))+
       scale_color_brewer(palette="Set1")


PR17


```


